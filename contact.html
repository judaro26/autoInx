<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contáctanos - AutoInx</title>
    <meta name="description" content="Contáctanos para preguntas generales o relacionadas con pedidos.">
    <link rel="icon" type="image/x-icon" href="/images/AutoInx logo.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/AutoInx logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 50%, #ddd6fe 100%);
            min-height: 100vh;
        }
        .floating-label-group {
            position: relative;
            margin-bottom: 2rem;
        }
        .floating-label-input {
            width: 100%;
            padding: 1.25rem 1rem 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1.1rem;
            background: white;
            transition: all 0.3s ease;
            outline: none;
        }
        .floating-label-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 5px rgba(99, 102, 241, 0.15);
        }
        .floating-label {
            position: absolute;
            left: 1rem;
            top: 1.25rem;
            font-size: 1.1rem;
            color: #94a3b8;
            pointer-events: none;
            transition: all 0.3s ease;
            transform-origin: left;
            font-weight: 500;
        }
        .floating-label-input:focus + .floating-label,
        .floating-label-input:not(:placeholder-shown) + .floating-label {
            top: 0.75rem;
            font-size: 0.85rem;
            color: #6366f1;
            font-weight: 700;
        }
        .pulse-button {
            position: relative;
            overflow: hidden;
        }
        .pulse-button::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .pulse-button:active::before {
            width: 300px;
            height: 300px;
        }
        .card-hover {
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card-hover:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 30px 60px rgba(99, 102, 241, 0.25) !important;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }
        .float-animation {
            animation: float 8s ease-in-out infinite;
        }
        .honeypot-field {
            position: absolute;
            left: -9999px;
            opacity: 0;
            visibility: hidden;
        }
    </style>
</head>
<body class="antialiased">
    <div class="flex flex-col min-h-screen">
        <div id="header-container"></div>

        <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12 items-start">
                <!-- Contact Form -->
                <div class="lg:col-span-2 order-2 lg:order-1">
                    <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border-t-8 border-indigo-600 p-6 sm:p-10 lg:p-12 card-hover float-animation">
                        <div class="text-center mb-8 sm:mb-12">
                            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 mb-4 leading-tight">
                                ¿En qué podemos ayudarte hoy?
                            </h1>
                            <p class="text-lg sm:text-xl lg:text-2xl text-gray-700 font-medium">Respuesta garantizada en menos de 24 horas</p>
                        </div>

                        <div id="messageContainer" class="mb-6 sm:mb-8"></div>

                        <form id="contactForm" onsubmit="window.module.submitContactForm(event)" class="space-y-6 sm:space-y-8">
                            <div class="floating-label-group">
                                <input type="text" id="contact-name" name="name" class="floating-label-input" placeholder=" " required>
                                <label for="contact-name" class="floating-label">Nombre Completo</label>
                            </div>

                            <div class="floating-label-group">
                                <input type="email" id="contact-email" name="email" class="floating-label-input" placeholder=" " required>
                                <label for="contact-email" class="floating-label">Correo Electrónico</label>
                            </div>

                            <div class="floating-label-group">
                                <select id="query-type" name="subjectType" class="floating-label-input" required>
                                    <option value="" disabled selected></option>
                                    <option value="general">Consulta General / Soporte</option>
                                    <option value="order">Pregunta sobre mi Pedido</option>
                                </select>
                                <label for="query-type" class="floating-label">Tipo de Consulta</label>
                            </div>

                            <div class="floating-label-group">
                                <textarea id="contact-message" name="message" rows="6" class="floating-label-input resize-none" placeholder=" " required></textarea>
                                <label for="contact-message" class="floating-label">Tu Mensaje (detalla lo más posible)</label>
                            </div>

                            <div class="honeypot-field" aria-hidden="true">
                                <input type="text" id="url-check" name="urlCheck" tabindex="-1" autocomplete="off">
                            </div>

                            <button type="submit" id="submitButton" class="w-full bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold text-xl sm:text-2xl py-5 sm:py-6 rounded-2xl shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300 pulse-button flex items-center justify-center">
                                <span id="buttonText" class="mr-4">Enviar Mensaje</span>
                                <svg id="spinner" class="animate-spin h-7 w-7 sm:h-8 sm:w-8 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Contact Info Sidebar -->
                <div class="space-y-8 order-1 lg:order-2">
                    <!-- WhatsApp & Email Card -->
                    <div class="bg-gradient-to-br from-pink-500 via-purple-600 to-indigo-700 text-white p-8 sm:p-10 rounded-3xl shadow-2xl card-hover">
                        <h3 class="text-3xl sm:text-4xl font-black mb-8 flex items-center">
                            <i class="fas fa-bolt mr-4 text-4xl sm:text-5xl"></i>
                            Respuesta Inmediata
                        </h3>
                        <div class="space-y-5">
                            <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-5 sm:p-6 hover:bg-white/30 transition">
                                <p class="text-base sm:text-lg opacity-90 mb-2">WhatsApp EE.UU.</p>
                                <a href="https://wa.me/19377016185" target="_blank" class="text-xl sm:text-2xl font-black flex items-center hover:scale-105 transition">
                                    <i class="fab fa-whatsapp mr-3 text-3xl sm:text-4xl"></i> (937) 701-6185
                                </a>
                            </div>
                            <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-5 sm:p-6 hover:bg-white/30 transition">
                                <p class="text-base sm:text-lg opacity-90 mb-2">WhatsApp Colombia</p>
                                <a href="https://wa.me/573217040789" target="_blank" class="text-xl sm:text-2xl font-black flex items-center hover:scale-105 transition">
                                    <i class="fab fa-whatsapp mr-3 text-3xl sm:text-4xl"></i> +57 321 704 0789
                                </a>
                            </div>
                            <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-5 sm:p-6">
                                <p class="text-base sm:text-lg opacity-90 mb-2">Soporte General</p>
                                <a href="mailto:support@autoinx.com" class="text-lg sm:text-xl font-bold flex items-center">
                                    <i class="fas fa-envelope mr-3 text-2xl"></i> support@autoinx.com
                                </a>
                            </div>
                            <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-5 sm:p-6">
                                <p class="text-base sm:text-lg opacity-90 mb-2">Pedidos</p>
                                <a href="mailto:orders@autoinx.com" class="text-lg sm:text-xl font-bold flex items-center">
                                    <i class="fas fa-shopping-bag mr-3 text-2xl"></i> orders@autoinx.com
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Hours Card -->
                    <div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-10 text-center card-hover border-t-8 border-green-500">
                        <i class="fas fa-clock text-5xl sm:text-7xl text-green-600 mb-6"></i>
                        <h4 class="text-2xl sm:text-3xl font-black text-gray-800 mb-4">Horario de Atención</h4>
                        <p class="text-xl sm:text-2xl font-bold text-gray-700">Lunes a Sábado</p>
                        <p class="text-4xl sm:text-5xl font-black text-green-600 mt-4">8:00 AM - 8:00 PM</p>
                        <p class="text-gray-500 mt-3 text-base sm:text-lg">Hora Colombia</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-gray-900 text-white py-12 sm:py-20 mt-12 sm:mt-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
                <h2 class="text-4xl sm:text-5xl lg:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 mb-4">
                    AutoInx
                </h2>
                <p class="text-xl sm:text-2xl text-gray-300 font-medium mb-6">Tu aliado confiable en repuestos automotrices</p>
                <p class="text-gray-500 text-base sm:text-lg">&copy; 2025 AutoInx • Operación Familiar • Colombia & USA</p>
            </div>
        </footer>
    </div>

    <div id="chatWidget" class="hidden"></div>

    <script>
        let currentLang = 'es';
        let chatWidgetEnabled = false;
        const GET_CONFIG_FUNCTION = '/.netlify/functions/getAdminConfig';
        const CONTACT_FUNCTION_URL = '/.netlify/functions/sendContactEmail';
        const WHATSAPP_LINK = 'https://wa.me/573217040789';

        const TEXT = {
            es: {
                title: 'Contáctanos',
                return: '← Volver a la Tienda',
                subjectGeneral: 'Consulta General / Soporte',
                subjectOrder: 'Pregunta sobre mi Pedido',
                sendBtn: 'Enviar Mensaje',
                successMsg: '¡Mensaje enviado con éxito! Te responderemos pronto.',
                errorMsg: 'Error al enviar el mensaje. Por favor, intenta de nuevo o usa el email directo.',
            },
            en: {
                title: 'Contact Us',
                return: '← Back to Store',
                subjectGeneral: 'General Inquiry / Support',
                subjectOrder: 'Order Question',
                sendBtn: 'Send Message',
                successMsg: 'Message sent successfully! We will reply soon.',
                errorMsg: 'Error sending message. Please try again or use the direct email.',
            }
        };

        const $ = id => document.getElementById(id);
        function t(key) {
            return TEXT[currentLang][key] || TEXT['es'][key];
        }

        function setLanguage(lang) {
            localStorage.setItem('contactLang', lang);
            currentLang = lang;
            render();
        }

        function toggleLoading(on) {
            const btn = $('submitButton');
            const spinner = $('spinner');
            const text = $('buttonText');
            if (!btn || !spinner || !text) return;
            btn.disabled = on;
            spinner.classList.toggle('hidden', !on);
            text.classList.toggle('hidden', on);
            if (!on) text.textContent = t('sendBtn');
        }

        function showMessage(type, msg, duration = 6000) {
            const el = $('messageContainer');
            if (!el) return;
            el.innerHTML = `
                <div class="p-4 sm:p-5 rounded-2xl font-bold text-base sm:text-lg text-center shadow-lg border-l-8 ${type==='success'?'bg-green-50 border-green-500 text-green-800':'bg-red-50 border-red-500 text-red-800'}">
                    ${msg}
                </div>`;
            setTimeout(() => { el.innerHTML = ''; }, duration);
        }

        async function submitContactForm(e) {
            e.preventDefault();
            toggleLoading(true);

            const formData = {
                name: $('contact-name').value.trim(),
                email: $('contact-email').value.trim(),
                subjectType: $('query-type').value,
                message: $('contact-message').value.trim(),
                urlCheck: $('url-check').value.trim(),
            };

            if (!formData.name || !formData.email || !formData.message || !formData.subjectType) {
                toggleLoading(false);
                return showMessage('error', t('errorMsg'));
            }

            try {
                const response = await fetch(CONTACT_FUNCTION_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    if (result.message && result.message.includes('bot detected')) {
                        console.log("Honeypot blocked bot");
                    }
                    showMessage('success', t('successMsg'));
                    e.target.reset();
                } else {
                    showMessage('error', result.error || t('errorMsg'));
                }
            } catch (error) {
                console.error("Error:", error);
                showMessage('error', t('errorMsg'));
            } finally {
                toggleLoading(false);
            }
        }

        async function fetchAdminConfig() {
            try {
                const res = await fetch(GET_CONFIG_FUNCTION);
                if (!res.ok) throw new Error("Config fetch failed");
                const config = await res.json();
                chatWidgetEnabled = !!config.chatWidgetEnabled && !config.maintenanceMode;
            } catch (err) {
                console.warn("Config error:", err);
                chatWidgetEnabled = false;
            }
        }

        function renderChatWidget() {
            const widget = $('chatWidget');
            if (!widget) return;
            if (!chatWidgetEnabled) {
                widget.classList.add('hidden');
                return;
            }
            widget.classList.remove('hidden');
            widget.className = "fixed bottom-6 right-6 z-50";
            widget.innerHTML = `
                <a href="${WHATSAPP_LINK}" target="_blank" rel="noopener"
                    class="block w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full shadow-2xl hover:shadow-3xl transform hover:scale-110 transition-all duration-300 flex items-center justify-center border-4 border-white"
                    aria-label="WhatsApp">
                    <i class="fab fa-whatsapp text-white text-4xl sm:text-5xl"></i>
                </a>
            `;
        }

        function renderHeader() {
            const headerHtml = `
                <header class="bg-white/90 backdrop-blur-2xl shadow-2xl sticky top-0 z-50 border-b border-gray-100">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-5 sm:py-6">
                        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                            <div class="flex items-center space-x-4">
                                <img src="/images/AutoInx logo.png" alt="AutoInx" class="h-12 sm:h-14 rounded-2xl shadow-xl">
                                <h1 class="text-3xl sm:text-5xl lg:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600">
                                    ${t('title')}
                                </h1>
                            </div>
                            <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-8">
                                <a href="/" class="text-indigo-600 hover:text-purple-600 font-bold text-lg sm:text-xl flex items-center hover:scale-110 transition">
                                    <i class="fas fa-arrow-left mr-2 text-xl sm:text-2xl"></i> ${t('return')}
                                </a>
                                <button onclick="setLanguage('${currentLang === 'es' ? 'en' : 'es'}')"
                                        class="px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-indigo-600 to-purple-700 text-white rounded-full font-bold text-base sm:text-lg hover:shadow-2xl transform hover:scale-105 transition">
                                    ${currentLang === 'es' ? 'English' : 'Español'}
                                </button>
                            </div>
                        </div>
                    </div>
                </header>`;

            $('header-container').innerHTML = headerHtml;

            // Update select options & button text on language change
            $('query-type').innerHTML = `
                <option value="" disabled selected></option>
                <option value="general">${t('subjectGeneral')}</option>
                <option value="order">${t('subjectOrder')}</option>
            `;
            $('buttonText').textContent = t('sendBtn');
        }

        function render() {
            renderHeader();
            renderChatWidget();
            document.documentElement.lang = currentLang;
        }

        async function initApp() {
            const storedLang = localStorage.getItem('contactLang');
            if (storedLang && TEXT[storedLang]) {
                currentLang = storedLang;
            } else {
                currentLang = (navigator.language || navigator.userLanguage).startsWith('en') ? 'en' : 'es';
            }
            await fetchAdminConfig();
            render();
        }

        window.module = {
            setLanguage,
            submitContactForm
        };

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

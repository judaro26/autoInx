# netlify.toml

[functions]
  directory = "netlify/functions" # This line is mandatory

# Existing Schedule (Runs at 3:00 AM UTC, assuming this is correct for your user cleanup)
[functions.anonymousUserCron]
  schedule = "0 3 * * *"

[functions.deleteOrder] # Target your delete function
  included_files = ["./netlify/functions/ip-data.json"]

# --- DYNAMIC CHAT WIDGET SCHEDULE (Runs every hour UTC) ---
# This single schedule replaces the old two-time triggers.
[functions.toggleChatWidget]
  function = "toggleChatWidget"
  schedule = "0 * * * *" 

# Public function remains the same
[functions.getGoogleMapsKey]
  access = "public"

[functions.send-receipt]
  # This ensures the HTML templates are uploaded with the javascript code
  included_files = ["netlify/functions/sendReceiptConfirmation/emailTemplates/*.html"]

[functions."sendReceiptConfirmation"]
  # Ensure templates are included
  included_files = ["netlify/functions/sendReceiptConfirmation/emailTemplates/*.html"]
  # Increase RAM to 1GB to handle the Chromium browser engine
  memory = 1024
  # Increase timeout to 20 seconds (PDFs take time to render)
  timeout = 20
  # Ensure the PDF library is bundled correctly
  node_bundler = "esbuild"
  external_node_modules = ["html-pdf-node"]
